<template>
  <div class="popup">
    <div class="view">
      <div class="page" data-name="infoPartido">
        <div class="navbar">
          <div class="navbar-inner sliding">
            <div class="left">
              <a href="#" class="link back">
                <i class="icon icon-back"></i>
                <span class="ios-only">Back</span>
              </a>
            </div>
            <div class="title">Eventos DavidMDL</div>
          </div>
        </div>
        <!-- Contenido -->
        <div class="page-content">
          <div class="block block-strong">
            <div class="title">Relllena datos</div>
          </div>
          <!-- <form action="" id="miFormulario"> -->
          <!-- <form id="my-form"> -->
          <form id="miFormulario">
            <div class="list">
              <ul>
                <li class="item-content item-input">
                  <div class="item-inner">
                    <div class="item-title item-floating-label">Nombre Completo</div>
                    <div class="item-input-wrap">
                      <input type="text" name="name" required validate pattern="[a-zA-ZñÑáéíóúÁÉÍÓÚüÜ ]{2,50}"
                        data-error-message="Nombre incorrecto">
                      <span class="input-clear-button"></span>
                    </div>
                  </div>
                </li>
              </ul>

              <ul>
                <li class="item-content item-input">
                  <div class="item-inner">
                    <div class="item-title item-floating-label">Correo</div>
                    <div class="item-input-wrap">
                      <input type="email" name="correo" required validate
                        pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$" data-error-message="correo incorrecto">
                      <span class="input-clear-button"></span>
                    </div>
                  </div>
                </li>
              </ul>
              <ul>
                <li class="item-content item-input">
                  <div class="item-inner">
                    <div class="item-title item-floating-label">Ciudad</div>
                    <div class="item-input-wrap">
                      <input type="text" name="ciudad" required validate pattern="[A-z ]{1,50}"
                        data-error-message="Ciudad incorrecta">
                      <span class="input-clear-button"></span>
                    </div>
                  </div>
                </li>
              </ul>
              <ul>
                <li class="item-content item-input">
                  <div class="item-inner">
                    <div class="item-title item-floating-label">DNI</div>
                    <div class="item-input-wrap">
                      <input type="text" name="dni" required validate pattern="[0-9]{8}[A-z]{1}"
                        data-error-message="DNI incorrecto">
                      <span class="input-clear-button"></span>
                    </div>
                  </div>
                </li>
              </ul>
              <ul>
                <li class="item-content item-input">
                  <div class="item-inner">
                    <div class="item-title item-label">Coche</div>
                    <!-- additional "input-dropdown-wrap" class -->
                    <div class="item-input-wrap input-dropdown-wrap">
                      <select required>
                        <option value="escoge">none</option>
                        <option value="saab">Saab</option>
                        <option value="mercedes">Mercedes</option>
                        <option value="audi">Audi</option>
                      </select>
                    </div>
                  </div>
                </li>
              </ul>

              <div class="block block-strong">
                <div class="title">¿Que te gusta?</div>
              </div>
              <ul>
                <li>
                  <label class="item-checkbox item-content">
                    <input type="checkbox" name="demo-checkbox" value="Books" />
                    <i class="icon icon-checkbox"></i>
                    <div class="item-inner">
                      <div class="item-title">Books</div>
                    </div>
                  </label>
                </li>
                <li>
                  <label class="item-checkbox item-content">
                    <input type="checkbox" name="demo-checkbox" value="Movies" />
                    <i class="icon icon-checkbox"></i>
                    <div class="item-inner">
                      <div class="item-title">Movies</div>
                    </div>
                  </label>
                </li>
                <li>
                  <label class="item-checkbox item-content">
                    <input type="checkbox" name="demo-checkbox" value="Food" />
                    <i class="icon icon-checkbox"></i>
                    <div class="item-inner">
                      <div class="item-title">Food</div>
                    </div>
                  </label>
                </li>
                <li>
                  <label class="item-checkbox item-content">
                    <input type="checkbox" name="demo-checkbox" value="Drinks" />
                    <i class="icon icon-checkbox"></i>
                    <div class="item-inner">
                      <div class="item-title">Drinks</div>
                    </div>
                  </label>
                </li>
              </ul>
              <div class="block-title">Fecha</div>
              <div class="list no-hairlines-md">
                <ul>
                  <li>
                    <div class="item-content item-input">
                      <div class="item-inner">
                        <div class="item-input-wrap">
                          <input type="text" placeholder="Select date" name="fecha" readonly="readonly"
                            id="demo-calendar-modal" />
                        </div>
                      </div>
                    </div>
                  </li>
                </ul>
              </div>

              <div>
                <canvas id="micanvas">Su navegador no soporta canvas :( </canvas>
                <div>
                  <p class="button" id="limpiar" style="margin-top: 25px;">Borrar</p>
                </div>
                <div>
                  <fieldset>
                    <button id="png">Guardar Imagen en PNG</button>
                  </fieldset>
                  <img src="" id="laimagen"/>
                </div>
              </div>


              <div class="block block-strong row">
                <div class="col">
                  <input class="button" value="Button" @click="enviarDatos">
                </div>
              </div>
            </div>
          </form>
          <!-- </form> -->
        </div>
      </div>
    </div>
  </div>
</template>

<script>
  return {

    // Component Data
    data: function () {
      // Must return an object

    },
    // Component Methods
    methods: {

      enviarDatos: function () {
        var self = this;
        var esFormCorrecto = true;
        //app.input.validateInputs(self.$el);
        $$('input[type=text], input[type=email]').each(function (elem) {
          var req = $$(this).prop("required");
          var name = $$(this).attr("name");
          console.log("each inputs", req, name);
          console.log(this);
          if ($$(this).val() === "" || $$(this).hasClass("input-invalid") === true) {
            app.input.validate($$(this));
            esFormCorrecto = false;
            console.log(esFormCorrecto);
          } else {
            console.log(esFormCorrecto);

          }
        });
        if (esFormCorrecto = true) {

          var formData = app.form.convertToData('#miFormulario');
          console.log(formData);
          alert(JSON.stringify(formData));

        }


        // if ($$('input').hasClass("input-invalid") == true){
        //   alert("Input no válido");
        // }else{
        //   var formData = app.form.convertToData('#miFormulario');
        // alert(JSON.stringify(formData));
        // }
        //var aux = app.input.validate($$('input[name=name]').value);
        //console.log("prueba", aux);
      },
    },
    // Page Events

    on: {

      popupOpened: function (e, page) {

        var calendarModal = app.calendar.create({
          inputEl: '#demo-calendar-modal',
          openIn: 'customModal',
          header: true,
          footer: true,
          dateFormat: 'MM dd yyyy',
        });

        // OBTENER CANVAS ------------------------------------------------------------------------------------------------


        var img = document.getElementById("laimagen");

        var png = document.getElementById("png");
        png.addEventListener("click", function () {
          var dato = canvas.toDataURL("image/png");
          dato = dato.replace("image/png", "image/octet-stream");
          document.location.href = dato;
        }, false);



        //CANVAS FIRMA -----------------------------------------------------------------------------------------------------

        var limpiar = document.getElementById("limpiar");
        var canvas = document.getElementById("micanvas");
        var ctx = canvas.getContext("2d");
        var cw = canvas.width = 300,
          cx = cw / 2;
        var ch = canvas.height = 300,
          cy = ch / 2;

        var dibujar = false;
        var factorDeAlisamiento = 5;
        var Trazados = [];
        var puntos = [];
        ctx.lineJoin = "round";

        limpiar.addEventListener('click', function (evt) {
          dibujar = false;
          ctx.clearRect(0, 0, cw, ch);
          Trazados.length = 0;
          puntos.length = 0;
        }, false);


        canvas.addEventListener('mousedown', function (evt) {
          dibujar = true;
          //ctx.clearRect(0, 0, cw, ch);
          puntos.length = 0;
          ctx.beginPath();

        }, false);

        canvas.addEventListener('mouseup', function (evt) {
          redibujarTrazados();
        }, false);

        canvas.addEventListener("mouseout", function (evt) {
          redibujarTrazados();
        }, false);

        canvas.addEventListener("mousemove", function (evt) {
          if (dibujar) {
            var m = oMousePos(canvas, evt);
            puntos.push(m);
            ctx.lineTo(m.x, m.y);
            ctx.stroke();
          }
        }, false);

        function reducirArray(n, elArray) {
          var nuevoArray = [];
          nuevoArray[0] = elArray[0];
          for (var i = 0; i < elArray.length; i++) {
            if (i % n == 0) {
              nuevoArray[nuevoArray.length] = elArray[i];
            }
          }
          nuevoArray[nuevoArray.length - 1] = elArray[elArray.length - 1];
          Trazados.push(nuevoArray);
        }

        function calcularPuntoDeControl(ry, a, b) {
          var pc = {}
          pc.x = (ry[a].x + ry[b].x) / 2;
          pc.y = (ry[a].y + ry[b].y) / 2;
          return pc;
        }

        function alisarTrazado(ry) {
          if (ry.length > 1) {
            var ultimoPunto = ry.length - 1;
            ctx.beginPath();
            ctx.moveTo(ry[0].x, ry[0].y);
            for (i = 1; i < ry.length - 2; i++) {
              var pc = calcularPuntoDeControl(ry, i, i + 1);
              ctx.quadraticCurveTo(ry[i].x, ry[i].y, pc.x, pc.y);
            }
            ctx.quadraticCurveTo(ry[ultimoPunto - 1].x, ry[ultimoPunto - 1].y, ry[ultimoPunto].x, ry[ultimoPunto].y);
            ctx.stroke();
          }
        }

        function redibujarTrazados() {
          dibujar = false;
          ctx.clearRect(0, 0, cw, ch);
          reducirArray(factorDeAlisamiento, puntos);
          for (var i = 0; i < Trazados.length; i++)
            alisarTrazado(Trazados[i]);
        }

        function oMousePos(canvas, evt) {
          var ClientRect = canvas.getBoundingClientRect();
          return { //objeto
            x: Math.round(evt.clientX - ClientRect.left),
            y: Math.round(evt.clientY - ClientRect.top)
          }
        }

        //FIN CANVAS FIRMA -----------------------------------------------------------------------------------------------------



        //alert("evento de cuando se abre el popup");
        //$$("input[name=name]").on('change', function(e){
        //console.log("evento change name");
        //});
        //$$("input[name=name]").on('input', function(e){
        // console.log("evento input name");
        //});

        //$$("input[type=text]").on("input", function(e){
        // console.log("estas escribiendo en ", $$(this).attr("name"));
        //console.log("Valor del campo ", $$(this).val());
        //});

        //$$('input[type=checkbox]').on('change', function(e) {
        // console.log("checked", $$(this).val());
        //});

        //evento js
        //document.getElementById("myInput").addEventListener("input",function(){
        //  console.log("has escrito en: " + this.name + "  " + this.value);});

      },
      /*
      popupOpen: function(e, page) {
        alert("evento de cuando esta apunto de abrir popup");
      },
      popupClosed: function(e, page) {
        alert("evento de cuando esta cerrado el popup");
      },
      popupClose: function(e, page) {
        alert("evento de cuando esta apunto de cerrar popup");
      }   
      */
    },

  }
</script>